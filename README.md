# 802Automation
Automation of 802 troops' office works.

### <서울지방경찰청 제2기동단 802의무경찰대 행정업무 자동화>
* 이 코드는 위 부대에서 매일 만들어 왔던 행정 문서 5개에 대한 자동화 코드입니다.
* 의무경찰 대원들의 영외활동과 근무일지 등에 대한 내용들을 포함하고 있으며, 개인 신상정보 및 부대 기밀 유출을 방지하고자 모든 이름과 내용들을 비식별화 하였습니다.
* 대원들의 이름은 http://www.hipenpal.com/tool/korean-names-make-my-korean-name-in-korean.php 에서 랜덤 생성한 이름들입니다.
* 구체적인 내용이나 사용에 대해서는 메일로 소속과 신상을 밝히셔야 공유해드릴 수 있습니다.
* hwp파일로 같은 작업을 매일 일일이 입력하고 수정해야 하는 번거로움을 없애고자 5개의 문서를 xlsx 내에 통합하여 이 template에 갱신되는 정보를 overwrite하도록 구현하였고, 
통합 인쇄 한 번으로 모든 출력이 가능하도록 하였습니다.
* 기존의 작업은 보통 40 ~ 60분이 소요되었으나 자동화 코드를 이용하면 1 ~ 3분 내로 효율적으로 모든 작업을 끝낼 수 있습니다.
* 열악한 환경과 부족한 코딩 실력으로 구현한 것이니 openpyxl을 이렇게 활용할 수 있구나 정도로 참고하면 좋을 것 같습니다.
* 개발한 당사자는 위 부대에서 근무했던 1115기 행정 대원입니다.

### Environments
* python 3.6.11
* pandas 1.1.5
* openpyxl 3.0.5
* 의무경찰대 또한 경찰 관공서에 해당하기 때문에 일반 인터넷 접속이 불가하여 python 설치파일과 라이브러리 whl 파일들을 따로 옮겨 설치한 후 cmd를 통해 실행하도록 하였습니다.

### How It Works
* Manual 파일을 참고해주세요.

### About openpyxl & automation
##### openpyxl
* python으로 xlsx를 읽고 쓸 수 있는 라이브러리로 기능이 많아서 선택하였는데 치명적인 문제가 있다.
* template에 overwrite하는 입장에서 template에 있는 테두리 형식이나 스타일이 깨지면 안 되는데 '병합된 셀의 테두리'는 openpyxl로 읽기만 해도 깨진다.
정확히는 병합된 셀 기준 왼쪽 위의 테두리만 남고 다 사라진다.
* https://stackoverflow.com/questions/38734044/losing-merged-cells-border-while-editing-excel-file-with-openpyxl
* 비슷한 선례를 경험하신 선구자들의 조언에 따라 왼쪽 위의 테두리 스타일을 읽어서 (openpyxl에서 이 정보만 살아남기 때문) 이를 나머지 셀의 테두리로 지정을 하면 
오른쪽 아래 셀을 제외하고서는 테두리 스타일 복붙이 된다.
* 오른쪽 아래 셀의 테두리까지 보존하기 위해 여러 실험을 통해 얻은 간단한 해결 방법은 애초에 template의 병합된 셀에서 오른쪽 아래 셀을 바로 그 오른쪽 셀의 '왼쪽' 테두리 지정으로 보정하는 것이다.
* 이것 외에도 print_area 설정시 원하는 width나 range 등 A4 인쇄 영역에 맞게 크기 값을 하드 코딩해야 하는 불편함이 다소 있었다.
* 참고로 열/행의 width/height 값은 엑셀 내에서 픽셀값 (괄호)안에 있는 크기이니 참고하면 좋을 것이다.
* 추가로 자동화 코드의 핵심이 의무경찰 대원의 영외활동 정보를 읽는 것인데 색으로 입력되어 있기 때문에 openpyxl을 통해 '색'을 정확하게 읽어야 한다.
 그러나 표준 원색에 대해서는 정확히 인식이 되지만 진한색에 대해서도 표준 원색 코드로 반환하는 문제점이 있다.
* 생각해보니 diagonal border도 write 후 깨지는 문제가 있다.
* 그렇지만 xlsxwriter 라이브러리에 비해서는 많은 기능들이 만족할 정도로 잘 구현되어 있었고 이를 최대한 잘 활용하여 구현할 수 있었다.

##### automation
* 초기의 구상으로는 작업스케쥴러+메모장(그 날이 되어서야 알 수 있는 입력 정보가 있기 때문)을 이용해서 완전 자동화로 만들고 싶었는데 의무경찰대의 익일 근무가 변칙적으로 공지되기 때문에 제외하였다.
* python을 모르는 후임 대원들이 이를 잘 사용하려면 cmd창에 출력되는 안내 메시지에 따라 쉽게 입력하여 통합 문서를 생성하고 수정사항도 output인 통합 xlsx에서 할 수 있도록 해야 하기 때문에
현재 구현 상태가 최선이라고 생각한다.
